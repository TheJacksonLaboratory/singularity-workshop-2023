<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Singularity Workshop 2023: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav "><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="" src="assets/images/-logo.svg">
</div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav " aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="" src="assets/images/-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Singularity Workshop 2023
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Singularity Workshop 2023
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Singularity Workshop 2023
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress ">
    <div class="progress-bar " role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-introduction.html">1. 00-introduction</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-intro-to-computers.html">2. 01-intro-to-computers</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-singularity-commands.html">3. 02-singularity-commands</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-singularity-pull-hello-world.html">4. 03-singularity-pull-hello-world</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="04-repos-and-registries.html">5. 04-repos-and-registries</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="05-singularity-build.html">6. 05-singularity-build</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="06-bioinformatics-qc.html">7. 06-bioinformatics-qc</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="07-bioinformatics-bwa.html">8. 07-bioinformatics bwa</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="08-circos.html">9. 08-circos</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="09-singularity-build-blast-example.html">10. 09-singularity-build</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="10-singularity_build_rstudio.html">11. 10-singularity-build-rstudio</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-00-introduction"><p>Content from <a href="00-introduction.html">00-introduction</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/00-introduction.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>This workshop is designed for a beginner with little to now</p>
<p>By the end of this workshop you will have:</p>
<ul>
<li><p>Created 16 contianers.</p></li>
<li><p>Executed 12+ commands with containers.</p></li>
<li><p>Build 2 custom containers.</p></li>
<li><p>Build 2 websites and viewed them with containers.</p></li>
<li><p>Run the most common singularity commands (pull, build,
exec)</p></li>
<li><p>Run the exec command command with bind mounts to access
data.</p></li>
<li><p>Encounter 3 gotchas and discuss solutions to deal with
them.</p></li>
<li><p>Gotcha 1: Repositories are managed by other users.</p></li>
<li><p>Solution 1: Keep good documentiaton on how your software was
built.</p></li>
<li><p>Gotcha 2: Cant mount the current working directory.<br></p></li>
<li><p>Solution 2: Try the <strong>-B $PWD</strong> flag.</p></li>
<li><p>Gotcha 3: Cant mount the the directory with the data.<br></p></li>
<li><p>Solution 3: Try the <strong>-B
<my_data_dir_path>:<my_data_dir_path></my_data_dir_path></my_data_dir_path></strong> flag.</p></li>
</ul>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 --></section></section><section id="aio-01-intro-to-computers"><p>Content from <a href="01-intro-to-computers.html">01-intro-to-computers</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/01-intro-to-computers.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<figure><img src="fig/01_computer_parts.svg" alt="A collection of computer parts including disks, ram, cpu" class="figure mx-auto d-block"><div class="figcaption">parts example</div>
</figure><section id="computer-component-review"><h2 class="section-heading">Computer Component Review<a class="anchor" aria-label="anchor" href="#computer-component-review"></a>
</h2>
<hr class="half-width">
<ul>
<li><p><strong>CPU:</strong> CPUs are the data process unit, they are
composed of multiple cores. For legacy reasons software often refers the
number of cores as the number of CPUs, so yeah that is
confusing.</p></li>
<li><p><strong>RAM (a.k.a MEMORY):</strong> RAM is fast digital storage.
Most programs utilize RAM for access to data needed more than once. RAM
is generally non-persistent when the powered off RAM memory is
lost.</p></li>
<li><p><strong>DISK:</strong> Disk is persistent digital storage that is
not as fast as RAM. Disk storage can be made up of one or more disks
such as hard drives (HDD) and/or Solid State Harddrives (SSD). Multiple
disk can be configured together for increased performance and drive
failure protection.</p></li>
<li><p><strong>NETWORKING:</strong> Switches and network access cards
within computers allow for computers to be networked together.</p></li>
<li><p><strong>GPU:</strong> A Graphics Processing Unit (GPU) is a
computer component that is capable of rendering graphics, these are also
useful for conducting certain mathematical calculations.</p></li>
</ul></section><section id="consumer-computer-vs-servers-vs-hpc-vs-sumhpc"><h2 class="section-heading">Consumer Computer vs Servers vs HPC vs Sumhpc<a class="anchor" aria-label="anchor" href="#consumer-computer-vs-servers-vs-hpc-vs-sumhpc"></a>
</h2>
<hr class="half-width">
<table class="table">
<colgroup>
<col width="7%">
<col width="15%">
<col width="7%">
<col width="20%">
<col width="17%">
<col width="17%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th>Component</th>
<th>Home/Busines Computer</th>
<th>Server</th>
<th>Typical Individual Node in HPC</th>
<th>Typical Total HPC System</th>
<th>Individual Node on Sumhpc</th>
<th>Total Sumhpc System</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>CPU (cores)</td>
<td>4 - 8</td>
<td>12 - 128</td>
<td>32 - 128</td>
<td>1000s</td>
<td>70*</td>
<td>7,000</td>
</tr>
<tr class="even">
<td>RAM(GB)</td>
<td>8 -16</td>
<td>64 - 960</td>
<td>240 - 3000</td>
<td>64,000</td>
<td>754 - 3TB</td>
<td>76.8 TB</td>
</tr>
<tr class="odd">
<td>DISK (TB)</td>
<td>.5 - 1 TB</td>
<td>8 - 100</td>
<td>None - 1 TB</td>
<td>100s (Networked)</td>
<td>NA</td>
<td>2.7 PB</td>
</tr>
<tr class="even">
<td>Networking (Gbe)</td>
<td>.1 - 1</td>
<td>1 - 10</td>
<td>40 - 100</td>
<td>40 - 100</td>
<td>40</td>
<td>40 +</td>
</tr>
</tbody>
</table></section><section id="computer-ports"><h2 class="section-heading">Computer Ports<a class="anchor" aria-label="anchor" href="#computer-ports"></a>
</h2>
<hr class="half-width">
<p>A port is a communication endpoint.</p>
</section><section id="introduction-to-os-virtual-machines-and-containers"><h2 class="section-heading">Introduction to OS, Virtual Machines and Containers<a class="anchor" aria-label="anchor" href="#introduction-to-os-virtual-machines-and-containers"></a>
</h2>
<hr class="half-width">
<p>Why can’t I use Docker? Docker images are not secure because they
allow users to gain root access to the compute nodes. Singularity
effectively runs as the user running the command and does not result in
elevated access. Also, docker interacts with the slurm job scheduler in
a way that causes resource requests and usages to not match up, making
it difficult to keep job queueing fair for all users. In that the
clusters are multi-user systems, we want to make sure people can work
without worry that others are accessing their data or unfairly using up
resources.</p>
</section><section id="important-notes-on-how-they-relate-to-singularity"><h2 class="section-heading">Important notes on how they relate to singularity<a class="anchor" aria-label="anchor" href="#important-notes-on-how-they-relate-to-singularity"></a>
</h2>
<hr class="half-width">
<p>-CPU There are 2 common CPU architectures in modern systems x86_64
and ARM. Singularity containers are architecture specific.<br><code>--arch string      architecture to pull from library (default "amd64")</code></p>
<div class="section level3">
<h3 id="citations">citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h3>
<p>Lesson adapted from:</p>
<p><a href="https://github.com/TheJacksonLaboratory/intro-to-hpc" class="external-link uri">https://github.com/TheJacksonLaboratory/intro-to-hpc</a></p>
<p><a href="https://crc.pitt.edu/singularity" class="external-link uri">https://crc.pitt.edu/singularity</a></p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</section></section><section id="aio-02-singularity-commands"><p>Content from <a href="02-singularity-commands.html">02-singularity-commands</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/02-singularity-commands.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level3">
<h3 id="fequently-used-singularity-commands">Fequently used singularity commands<a class="anchor" aria-label="anchor" href="#fequently-used-singularity-commands"></a>
</h3>
<ul>
<li><p><strong>singularity pull</strong></p></li>
<li><p><strong>singularity shell</strong></p></li>
<li><p><strong>singularity cache</strong></p></li>
<li><p><strong>singularity build</strong></p></li>
<li><p><strong>singularity exec</strong></p></li>
</ul>
<p><strong>These hands on tutorial are being conducted on a base Centos7
OS VM with the following programs installed.</strong></p>
<ul>
<li><p>apptainer (including the alias singularity)</p></li>
<li><p>nano</p></li>
<li><p>wget</p></li>
<li><p>unzip</p></li>
</ul>
<p><strong>The following ports have been made available to the
system:</strong></p>
<ul>
<li>8080,8787,8789</li>
</ul>
<p><strong>The following folders have been setup on the remote
system:</strong></p>
<ul>
<li>/projects/my-lab</li>
<li>/flashscratch</li>
<li>/workshop_data</li>
</ul>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div></section><section id="aio-03-singularity-pull-hello-world"><p>Content from <a href="03-singularity-pull-hello-world.html">03-singularity-pull-hello-world</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/03-singularity-pull-hello-world.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level3">
<h3 id="the-singularity-pull-command">The Singularity Pull command<a class="anchor" aria-label="anchor" href="#the-singularity-pull-command"></a>
</h3>
<p>The most basic command:<br><code>singularity pull &lt;URL&gt;</code></p>
<p>Can specify a new container (*.sif) name:<br><code>singularity pull &lt;New_container_Name&gt; &lt;URL&gt;</code></p>
<p>Example (dont run yet):<br><code>singularity pull docker://rocker/tidyverse:4.2.1</code></p>
<p>Example making a new name (dont run yet):<br><code>singularity pull awesome_container.sif docker://rocker/tidyverse:4.2.1</code></p>
</div>
<div class="section level3">
<h3 id="tags">Tags<a class="anchor" aria-label="anchor" href="#tags"></a>
</h3>
<p>Singularity and docker uses tags, these can be used to access
specific versions or distributions of the softwares.</p>
<p>Of note the images and tags can change inside the repo, so for
complete repoducibility purposes you may want to retain the software or
build from source.</p>
</div>
<div class="section level3">
<h3 id="singularity-can-pull-from-5-types-of-uris">Singularity can pull from 5 types of URIs<a class="anchor" aria-label="anchor" href="#singularity-can-pull-from-5-types-of-uris"></a>
</h3>
<ul>
<li><p><strong>library</strong> : Pull an image from the currently
configured library. See here for configuring a libary.<br><code>library://user/collection/container:tag</code></p></li>
<li><p><strong>docker</strong> : Pull a Docker/OCI image from Docker
Hub, or another OCI registry. OCI stands for open container
registry.<br><code>docker://user/image:tag</code></p></li>
<li><p><strong>shub</strong> : Pull an image from Singularity Hub<br><code>shub://user/image:tag</code></p></li>
<li><p><strong>oras</strong> : Pull a SIF image from an OCI registry
that supports ORAS. GCP artifcact registry supports.<br><code>oras://registry/namespace/image:tag</code></p></li>
<li><p><strong>http, https</strong> : Pull an image using the http(s?)
protocol<br><code>https://library.sylabs.io/v1/imagefile/library/default/alpine:latest</code></p></li>
</ul>
</div>
<div class="section level3">
<h3 id="a-note-on-security-and-saftey">A note on security and saftey<a class="anchor" aria-label="anchor" href="#a-note-on-security-and-saftey"></a>
</h3>
<p>Only pull from <strong>trusted sources</strong>. Generally sepeaking
containers provided by trusted orginizations or the developer are ideal
sources.</p>
<p>Dockerhub shows how many pulls each container had had as well as
Dockerhub provided tags: <em>Docker Official Image</em>, <em>Verified
Publisher</em>, and <em>Sponsored OSS</em></p>
<p>Lets take look a some dockerhub docker images sources that we will be
using today.</p>
<ul>
<li><p><strong>staphb</strong><br><code>https://hub.docker.com/search?q=staphb&amp;image_filter=open_source</code></p></li>
<li><p><strong>biocontainers</strong><br><code>https://hub.docker.com/r/biocontainers/biocontainers</code></p></li>
</ul>
<p>Now lets look at a non-standard example of a program called Busco
that can be used for Phylogenetic analysis as well as assessing genomic
data quality (assemblies).</p>
<p>The home page:<br><code>https://busco.ezlab.org/</code></p>
<p>The User Guide:<br><code>https://busco.ezlab.org/busco_userguide.html</code></p>
<p>Here we see where to access the docker image and the directions to
run it with docker (but not sinuglarity can we get it to work? we will
see later).<br><code>https://busco.ezlab.org/busco_userguide.html#docker-image</code></p>
</div>
<div class="section level3">
<h3 id="hello-world-example">Hello World Example<a class="anchor" aria-label="anchor" href="#hello-world-example"></a>
</h3>
</div>
<div class="section level3">
<h3 id="verify-r-in-not-on-system">Verify R in not on system<a class="anchor" aria-label="anchor" href="#verify-r-in-not-on-system"></a>
</h3>
<p>Try to start <em>R</em> on they command line by typing
<em>R</em>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">--help</span></span></code></pre>
</div>
<p>We get an error because <em>R</em> is not available.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-bash: R: command not found</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="lets-pull-a-r-containter-from-docker-hub">Lets pull a R containter from Docker Hub<a class="anchor" aria-label="anchor" href="#lets-pull-a-r-containter-from-docker-hub"></a>
</h3>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">singularity</span> pull docker://rocker/tidyverse:4.2.1</span></code></pre>
</div>
<p>Singularity builds the image. Singularity copies the OCI blobs/layers
to the local cache then builds the image (SIF file).</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO:    Converting OCI blobs to SIF format
INFO:    Starting build...
Getting image source signatures
Copying blob 7917df3ef3d8 done
Copying blob 270b4100b33a done
Copying blob 56e0351b9876 done
Copying blob 2faad9a83b09 done
Copying blob 81c9ee1c97bb done
Copying blob d518d22d5d29 done
Copying blob 27c3a6114c0b done
Copying blob 58e0d5c15b4e done
Copying blob 3ccbc1cfa6d1 done
Copying config 1bec811255 done
Writing manifest to image destination
Storing signatures
2023/07/31 02:43:50  info unpack layer: sha256:56e0351b98767487b3c411034be95479ed1710bb6be860db6df0be3a98653027
2023/07/31 02:43:50  info unpack layer: sha256:270b4100b33a95ddd4b4e0d4cce9c4a262eaf5043a4d6a33a82fc71224e7f857
2023/07/31 02:43:50  info unpack layer: sha256:2faad9a83b09e8155e7084ed53957d556333d8c78dbd66288dda084362d9a8a0
2023/07/31 02:43:56  info unpack layer: sha256:d518d22d5d29e561be6588568fd73aff10b6e658a3a3a9e8e98c0470e1b21a8a
2023/07/31 02:43:56  info unpack layer: sha256:81c9ee1c97bb79e966a4ea76644eb05ebc6b72f67dfdccb9e8f4bce3190cdd0a
2023/07/31 02:43:57  info unpack layer: sha256:7917df3ef3d8605361342bc11f7d527ebb4fea3f95704bb6b72e6a4f043faa6d
2023/07/31 02:44:11  info unpack layer: sha256:27c3a6114c0bacba4ceb4e0523ee67bfcc5bec7f7824247b6578cdcb629f4978
2023/07/31 02:44:11  info unpack layer: sha256:58e0d5c15b4e6c88ede882864475388b1479a3d81c1b4060aeb919a3a3b5f322
2023/07/31 02:44:11  info unpack layer: sha256:3ccbc1cfa6d1cbc33689c9e7c2ebcafcb0af4f895b38c84363f57417e6fbb7cb
INFO:    Creating SIF file...</code></pre>
</div>
<p>Note when pulling the image it downloads each layer, storing them in
the <strong>cache</strong> and stiches them together in the singularity
image file. The singularity image is immutable.</p>
</div>
<div class="section level3">
<h3 id="use-ls-to-view-the-new-file">Use ls to view the new file<a class="anchor" aria-label="anchor" href="#use-ls-to-view-the-new-file"></a>
</h3>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 333280
-rw-rw-r-- 1 student student         0 Jul 30 22:43 test_scp.txt
-rwxrwxr-x 1 student student 324775936 Apr  1 01:09 tidyverse_4.2.1.sif*</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="use-ls--lfa-to-see-the-hidden-files-">Use ls -lFa to see the hidden files.<a class="anchor" aria-label="anchor" href="#use-ls--lfa-to-see-the-hidden-files-"></a>
</h3>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lFa</span></span></code></pre>
</div>
<p>We can see the hidden directory <strong>.apptainer</strong> that
contains the cache.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 692628
drwxr-xr-x  4 student student              155 Jul 31 02:45 ./
drwx------  3 student student               19 Jul 31 02:43 .apptainer/
-rw-r--r--  1 student student               18 Nov 24  2021 .bash_logout
-rw-r--r--  1 student student              193 Nov 24  2021 .bash_profile
-rw-r--r--  1 student student              231 Nov 24  2021 .bashrc
drwx------  3 student student               19 Jul 31 02:43 .local/
-rw-r--r--  1 student root                  38 Jul 31 02:34 test_scp.txt
-rwxrwxr-x  1 student student        709230592 Jul 31 02:45 tidyverse_4.2.1.sif*
-rw-r--r--  1 student student              658 Apr  7  2020 .zshrc</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span> .apptainer/</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">cache</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span> .apptainer/cache/blob/blobs/sha256/</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rw-r--r-- 1 student student      7763 Jul 31 02:43 1bec8112559e0494f45c74ee43af6d28b117a6faa7ff8e3aaefea9e741aedc47
-rw-r--r-- 1 student student      1807 Jul 31 02:43 270b4100b33a95ddd4b4e0d4cce9c4a262eaf5043a4d6a33a82fc71224e7f857
-rw-r--r-- 1 student student     27244 Jul 31 02:43 27c3a6114c0bacba4ceb4e0523ee67bfcc5bec7f7824247b6578cdcb629f4978
-rw-r--r-- 1 student student 250108813 Jul 31 02:43 2faad9a83b09e8155e7084ed53957d556333d8c78dbd66288dda084362d9a8a0
-rw-r--r-- 1 student student 164652314 Jul 31 02:43 3ccbc1cfa6d1cbc33689c9e7c2ebcafcb0af4f895b38c84363f57417e6fbb7cb
-rw-r--r-- 1 student student  27506421 Jul 31 02:43 56e0351b98767487b3c411034be95479ed1710bb6be860db6df0be3a98653027
-rw-r--r-- 1 student student     54081 Jul 31 02:43 58e0d5c15b4e6c88ede882864475388b1479a3d81c1b4060aeb919a3a3b5f322
-rw-r--r-- 1 student student 243220058 Jul 31 02:43 7917df3ef3d8605361342bc11f7d527ebb4fea3f95704bb6b72e6a4f043faa6d
-rw-r--r-- 1 student student  37945014 Jul 31 02:43 81c9ee1c97bb79e966a4ea76644eb05ebc6b72f67dfdccb9e8f4bce3190cdd0a
-rw-r--r-- 1 student student      2016 Jul 31 02:43 ae0677065e80ef796cdadccfbfb18370b194bc057bec8200d2dbe6b173048935
-rw-r--r-- 1 student student     22169 Jul 31 02:43 d518d22d5d29e561be6588568fd73aff10b6e658a3a3a9e8e98c0470e1b21a8a</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">singularity</span> cache clean</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span> .apptainer/cache/blob/blobs/sha256/</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="run-the-r-help-command">Run the R help command<a class="anchor" aria-label="anchor" href="#run-the-r-help-command"></a>
</h3>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">singularity</span> exec tidyverse_4.2.1.sif R <span class="at">--help</span></span></code></pre>
</div>
<p>It works now you can see the R program output.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Usage: R [options] [&lt; infile] [&gt; outfile]
   or: R CMD command [arguments]

Start R, a system for statistical computation and graphics, with the
specified options, or invoke an R tool via the 'R CMD' interface.

Options:
  -h, --help            Print short help message and exit
  --version             Print version info and exit
  --encoding=ENC        Specify encoding to be used for stdin
  --encoding ENC
  RHOME                 Print path to R home directory and exit
  --save                Do save workspace at the end of the session
  --no-save             Don't save it
  --no-environ          Don't read the site and user environment files
  --no-site-file        Don't read the site-wide Rprofile
  --no-init-file        Don't read the user R profile
  --restore             Do restore previously saved objects at startup
  --no-restore-data     Don't restore previously saved objects
  --no-restore-history  Don't restore the R history file
  --no-restore          Don't restore anything
  --vanilla             Combine --no-save, --no-restore, --no-site-file,
                        --no-init-file and --no-environ
  --no-readline         Don't use readline for command-line editing
  --max-ppsize=N        Set max size of protect stack to N
  --min-nsize=N         Set min number of fixed size obj's ("cons cells") to N
  --min-vsize=N         Set vector heap minimum to N bytes; '4M' = 4 MegaB
  -q, --quiet           Don't print startup message
  --silent              Same as --quiet
  -s, --no-echo         Make R run as quietly as possible
  --interactive         Force an interactive session
  --verbose             Print more information about progress
  -d, --debugger=NAME   Run R through debugger NAME
  --debugger-args=ARGS  Pass ARGS as arguments to the debugger
  -g TYPE, --gui=TYPE   Use TYPE as GUI; possible values are 'X11' (default)
                        and 'Tk'.
  --arch=NAME           Specify a sub-architecture
  --args                Skip the rest of the command line
  -f FILE, --file=FILE  Take input from 'FILE'
  -e EXPR               Execute 'EXPR' and exit

FILE may contain spaces but not shell metacharacters.

Commands:
  BATCH                 Run R in batch mode
  COMPILE               Compile files for use with R
  SHLIB                 Build shared library for dynamic loading
  INSTALL               Install add-on packages
  REMOVE                Remove add-on packages
  build                 Build add-on packages
  check                 Check add-on packages
  LINK                  Front-end for creating executable programs
  Rprof                 Post-process R profiling files
  Rdconv                Convert Rd format to various other formats
  Rd2pdf                Convert Rd format to PDF
  Rd2txt                Convert Rd format to pretty text
  Stangle               Extract S/R code from Sweave documentation
  Sweave                Process Sweave documentation
  Rdiff                 Diff R output ignoring headers etc
  config                Obtain configuration information about R
  javareconf            Update the Java configuration variables
  rtags                 Create Emacs-style tag files from C, R, and Rd files

Please use 'R CMD command --help' to obtain further information about
the usage of 'command'.

Options --arch, --no-environ, --no-init-file, --no-site-file and --vanilla
can be placed between R and CMD, to apply to R processes run by 'command'

Report bugs at &lt;https://bugs.R-project.org&gt;.</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="run-the-rscript-help-command">Run the Rscript help command<a class="anchor" aria-label="anchor" href="#run-the-rscript-help-command"></a>
</h3>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">singularity</span> exec tidyverse_4.2.1.sif Rscript <span class="at">--help</span></span></code></pre>
</div>
<p>It works now you can see the Rscript program output.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Usage: Rscript [options] file [args]
   or: Rscript [options] -e expr [-e expr2 ...] [args]
A binary front-end to R, for use in scripting applications.

Options:
  --help              Print usage and exit
  --version           Print version and exit
  --verbose           Print information on progress
  --default-packages=LIST  Attach these packages on startup;
                        a comma-separated LIST of package names, or 'NULL'
and options to R (in addition to --no-echo --no-restore), for example:
  --save              Do save workspace at the end of the session
  --no-environ        Don't read the site and user environment files
  --no-site-file      Don't read the site-wide Rprofile
  --no-init-file      Don't read the user R profile
  --restore           Do restore previously saved objects at startup
  --vanilla           Combine --no-save, --no-restore, --no-site-file,
                        --no-init-file and --no-environ

Expressions (one or more '-e &lt;expr&gt;') may be used *instead* of 'file'.
Any additional 'args' can be accessed from R via 'commandArgs(TRUE)'.
See also  ?Rscript  from within R.
</code></pre>
</div>
<p>Lets go inside of the container and see what we see.</p>
<p>First lets verify that we can see other directories.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">ls</span> /projects/my-lab</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">singularity</span> shell tidyverse_4.2.1.sif </span></code></pre>
</div>
<p>Notice the prompt changed to <strong>Apptainer</strong></p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lFa</span></span></code></pre>
</div>
<p>Same outout as before.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 692628
drwxr-xr-x 4 student student       155 Jul 31 02:45 ./
drwxr-xr-x 4 student student        80 Jul 31 02:58 ../
drwx------ 3 student student        19 Jul 31 02:43 .apptainer/
-rw-r--r-- 1 student student        18 Nov 24  2021 .bash_logout
-rw-r--r-- 1 student student       193 Nov 24  2021 .bash_profile
-rw-r--r-- 1 student student       231 Nov 24  2021 .bashrc
drwx------ 3 student student        19 Jul 31 02:43 .local/
-rw-r--r-- 1 student student        38 Jul 31 02:34 test_scp.txt
-rwxrwxr-x 1 student student 709230592 Jul 31 02:45 tidyverse_4.2.1.sif*
-rw-r--r-- 1 student student       658 Apr  7  2020 .zshrc</code></pre>
</div>
<p>Try to view the projects directory.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">ls</span> /projects/my-lab</span></code></pre>
</div>
<p>We get an error because the container can not see the directory. By
default the container only mounts the <em>home</em> and current
<em>working</em> directory. If you need to access something outside
these directories you’ll need to use a bind mount (more on this
later).</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ls: cannot access '/projects/my-lab': No such file or directory</code></pre>
</div>
<p>Lets exit the container</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="bu">exit</span></span></code></pre>
</div>
<p>View the container os</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">singularity</span> exec tidyverse_4.2.1.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span></code></pre>
</div>
<p>Lets use the inspect command to see details about the container</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">singularity</span> inspect tidyverse_4.2.1.sif </span></code></pre>
</div>
<p>We get some several detais about this contianer. Lets see if we can
find out more about this container build by researching the source
link.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>org.label-schema.build-arch: amd64
org.label-schema.build-date: Monday_31_July_2023_2:44:16_UTC
org.label-schema.schema-version: 1.0
org.label-schema.usage.apptainer.version: 1.1.9-1.el7
org.label-schema.usage.singularity.deffile.bootstrap: docker
org.label-schema.usage.singularity.deffile.from: rocker/tidyverse:4.2.1
org.opencontainers.image.authors: Carl Boettiger &lt;cboettig@ropensci.org&gt;
org.opencontainers.image.base.name: docker.io/rocker/rstudio:4.2.1
org.opencontainers.image.description: Version-stable build of R, RStudio Server, and R packages.
org.opencontainers.image.licenses: GPL-2.0-or-later
org.opencontainers.image.ref.name: ubuntu
org.opencontainers.image.revision: ef593dcd7b334e02e79188a9e17dcf6149c178b9
org.opencontainers.image.source: https://github.com/rocker-org/rocker-versioned2
org.opencontainers.image.title: rocker/tidyverse
org.opencontainers.image.vendor: Rocker Project
org.opencontainers.image.version: R-4.2.1</code></pre>
</div>
<p>The Rocker github provided a lot of detail about the builds.</p>
</div>
<div class="section level3">
<h3 id="citations-and-notes">Citations and Notes<a class="anchor" aria-label="anchor" href="#citations-and-notes"></a>
</h3>
<p><a href="https://docs.sylabs.io/guides/3.7/user-guide/cli/singularity_pull.html" class="external-link uri">https://docs.sylabs.io/guides/3.7/user-guide/cli/singularity_pull.html</a></p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div></section><section id="aio-04-repos-and-registries"><p>Content from <a href="04-repos-and-registries.html">04-repos-and-registries</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/04-repos-and-registries.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level3">
<h3 id="building-options">Building options<a class="anchor" aria-label="anchor" href="#building-options"></a>
</h3>
<ul>
<li><p>Build from a repositor with the build or pull command. Works fine
for things that are ready to go</p></li>
<li><p>Use a remote builder Sylabs/GCP Builder.</p></li>
<li><p>Use a system with sudo, for instance a cloud VM like we are using
today.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="review-the-remote-builder-directions">Review the remote builder directions<a class="anchor" aria-label="anchor" href="#review-the-remote-builder-directions"></a>
</h3>
<p>We will omit Sylabs remote builder and repositories in this tutorial
since it requiress an external account creation.</p>
<p>A cloud instance with a few programs (apptainer, nano, wget,
unzip,nvidia-smi) are a good alternative to remote builders.</p>
<p><a href="https://docs.sylabs.io/guides/3.2/user-guide/cloud_library.html" class="external-link uri">https://docs.sylabs.io/guides/3.2/user-guide/cloud_library.html</a></p>
<p>Sylabs also have several YouTube Videos on using Singularity:</p>
<p>The 5 part Singularity Container Workflow Demo is a good place to
start.</p>
<p>Part 1:<br><a href="https://www.youtube.com/watch?v=nQTMJ9hqKNI&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=1" class="external-link uri">https://www.youtube.com/watch?v=nQTMJ9hqKNI&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=1</a><br>
Part 2:<br><a href="https://www.youtube.com/watch?v=23KOlEouAiI&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=2" class="external-link uri">https://www.youtube.com/watch?v=23KOlEouAiI&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=2</a><br>
Part 3: <a href="https://www.youtube.com/watch?v=I5M6er06lT0&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=3" class="external-link uri">https://www.youtube.com/watch?v=I5M6er06lT0&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=3</a><br>
Part 4:<br><a href="https://www.youtube.com/watch?v=eb8vFmYLNTg&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=4" class="external-link uri">https://www.youtube.com/watch?v=eb8vFmYLNTg&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=4</a><br>
Part 5:<br><a href="https://www.youtube.com/watch?v=CFxngpNl1nU&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=5" class="external-link uri">https://www.youtube.com/watch?v=CFxngpNl1nU&amp;list=PL052H4iYGzyvdZ8VS-omTzj1FKMjdXzfB&amp;index=5</a></p>
</div>
<div class="section level3">
<h3 id="some-note-worthy-registries-and-sources-of-software">Some note worthy registries and sources of software<a class="anchor" aria-label="anchor" href="#some-note-worthy-registries-and-sources-of-software"></a>
</h3>
<ul>
<li><p>Docker Hub</p></li>
<li><p><a href="https://hub.docker.com/" class="external-link uri">https://hub.docker.com/</a></p></li>
<li><p>Singularity Hub (Singularity Hub is no longer online as a builder
service, but containers built before April 19, 2021 are
available).</p></li>
<li><p>Galaxy several Nextflow nf-core containers are pulled from the
galaxy project.</p></li>
<li><p>example: <a href="https://github.com/nf-core/rnaseq/blob/3.12.0/modules/nf-core/fastqc/main.nf" class="external-link uri">https://github.com/nf-core/rnaseq/blob/3.12.0/modules/nf-core/fastqc/main.nf</a></p></li>
<li><p>Sylabs</p></li>
<li><p><a href="https://cloud.sylabs.io/" class="external-link uri">https://cloud.sylabs.io/</a></p></li>
<li><p>Sylabs also has a remote builder.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="lets-pull-some-bioinformatic-software-from-the-registries-and-see-what-we-can-get-">Lets pull some bioinformatic software from the registries and see
what we can get.<a class="anchor" aria-label="anchor" href="#lets-pull-some-bioinformatic-software-from-the-registries-and-see-what-we-can-get-"></a>
</h3>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> /projects/my-lab/04-pull</span></code></pre>
</div>
<p>Check and see what is in the directory.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span></span></code></pre>
</div>
<p>Nothing, just an empty directory.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 0</code></pre>
</div>
<p>Lets look at the busco pull command from earlier, dont execute
it.</p>
<pre class="text"><code>docker pull ezlabgva/busco:v5.4.7_cv1</code></pre>
<p>Modify for singularity and pull it down.<br>
Maybe put docker, colon, forward slash,forward slash to a jingle as we
will be using it often.</p>
<p><code>docker://</code></p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">singularity</span> pull docker://ezlabgva/busco:v5.4.7_cv1</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO:    Converting OCI blobs to SIF format
INFO:    Starting build...
Getting image source signatures
Copying blob 700f250e37eb done
Copying blob da52c665ae6a done
Copying blob 230a319b6d10 done
Copying blob f7ec5a41d630 done
Copying blob a3ed95caeb02 done
Copying blob bffdb47af6a2 done
Copying blob 519cab61f8f7 done
Copying blob 3b07ee5f9c53 done
Copying config edd7eca642 done
Writing manifest to image destination
Storing signatures
2023/07/31 03:16:00  info unpack layer: sha256:f7ec5a41d630a33a2d1db59b95d89d93de7ae5a619a3a8571b78457e48266eba
2023/07/31 03:16:01  info unpack layer: sha256:da52c665ae6a3c231308941f65380e35950ef6c10aca2d47181c8ebf4915f6f1
2023/07/31 03:16:01  info unpack layer: sha256:bffdb47af6a29dd80fefdab2010f1c359c84e20797d0e22385589287bd992ace
2023/07/31 03:16:01  info unpack layer: sha256:230a319b6d10d18fb27a90920929d39624ae864f9d1b1ce2b82f579b084dcd94
2023/07/31 03:16:01  info unpack layer: sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4
2023/07/31 03:16:01  info unpack layer: sha256:700f250e37ebd4b22828d661f4a53537cd504b8d09d843bc1cbf01d36f622d3e
2023/07/31 03:16:31  info unpack layer: sha256:519cab61f8f7703cf31e02e406e11571d9432e3c3abbcd57ed5ea01b20a68199
2023/07/31 03:16:31  info unpack layer: sha256:3b07ee5f9c539bdb444c78a97e1578d7c10b0dc1a8f9b6c89de29ff1d367bdb4
INFO:    Creating SIF file...</code></pre>
</div>
<p>Lets see what happened.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lFa</span></span></code></pre>
</div>
<p>We see a busco sif file but nothing else. The cache is in the home
directory.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ls -alF
total 802912
drwxr-xr-x  2 student root           34 Jul 31 03:17 ./
drwxr-xr-x 11 student root          165 Jul 31 02:34 ../
-rwxrwxr-x  1 student student 822181888 Jul 31 03:17 busco_v5.4.7_cv1.sif*</code></pre>
</div>
<p>Lets see if it works by pulling down a couple of Staphylococcus
aureus bacteria proteomes.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">wget</span> https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/013/425/GCF_000013425.1_ASM1342v1/GCF_000013425.1_ASM1342v1_protein.faa.gz</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">wget</span> https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/003/264/815/GCF_003264815.1_ASM326481v1/GCF_003264815.1_ASM326481v1_protein.faa.gz</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">gunzip</span> ./GCF_000013425.1_ASM1342v1_protein.faa.gz ./GCF_003264815.1_ASM326481v1_protein.faa.gz</span></code></pre>
</div>
<p>Lets run the busco command.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">singularity</span> exec ./busco_v5.4.7_cv1.sif busco <span class="at">-i</span> GCF_000013425.1_ASM1342v1_protein.faa <span class="at">-l</span> bacteria_odb10 <span class="at">-o</span>  busco_out_GCF_000013425 <span class="at">-m</span> protein </span></code></pre>
</div>
<p>Oh no, we got an error, its ok there is an easy fix. We can add the
<strong>–bind $PWD</strong> to specifically request the current
directory to be mounted.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">--bind</span> <span class="va">$PWD</span> ./busco_v5.4.7_cv1.sif busco <span class="at">-i</span> GCF_000013425.1_ASM1342v1_protein.faa <span class="at">-l</span> bacteria_odb10 <span class="at">-o</span>  busco_out_GCF_000013425 <span class="at">-m</span> protein </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">--bind</span> <span class="va">$PWD</span> ./busco_v5.4.7_cv1.sif busco <span class="at">-i</span> GCF_003264815.1_ASM326481v1_protein.faa <span class="at">-l</span> bacteria_odb10 <span class="at">-o</span>  busco_out_GCF_003264815 <span class="at">-m</span> protein </span></code></pre>
</div>
<p>Now lets download some more tools. What was that jingle again …</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">singularity</span> pull docker://staphb/bwa:0.7.17</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">singularity</span> pull docker://staphb/samtools:1.17-2023-06</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="ex">singularity</span> pull docker://staphb/bedtools:2.31.0</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="ex">singularity</span> pull docker://staphb/blast:2.14.0</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="ex">singularity</span> pull docker://staphb/bcftools:1.17</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="ex">singularity</span> pull docker://staphb/ncbi-datasets</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="ex">singularity</span> pull docker://biocontainers/vcftools:v0.1.16-1-deb_cv1</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="ex">singularity</span> pull docker://biocontainers/bedops:v2.4.35dfsg-1-deb_cv1</span></code></pre>
</div>
<p>Lets see what we pulled down.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span> <span class="at">-1</span> <span class="pp">*</span>sif</span></code></pre>
</div>
<p>Thats alot of software ready to go. We see a wide range in sizes for
the various software.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rwxrwxr-x 1 student student 119M Jul 31 07:53 bcftools_1.17.sif
-rwxrwxr-x 1 student student  59M Jul 31 07:53 bedops_v2.4.35dfsg-1-deb_cv1.sif
-rwxrwxr-x 1 student student  44M Jul 31 07:52 bedtools_2.31.0.sif
-rwxrwxr-x 1 student student 265M Jul 31 07:53 blast_2.14.0.sif
-rwxrwxr-x 1 student student 785M Jul 31 07:48 busco_v5.4.7_cv1.sif
-rwxrwxr-x 1 student student  76M Jul 31 07:52 bwa_0.7.17.sif
-rwxrwxr-x 1 student student  43M Jul 31 07:53 ncbi-datasets_latest.sif
-rwxrwxr-x 1 student student  44M Jul 31 07:52 samtools_1.17-2023-06.sif
-rwxrwxr-x 1 student student  61M Jul 31 07:53 vcftools_v0.1.16-1-deb_cv1.sif</code></pre>
</div>
<p>Lets see what they used for the base images.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">singularity</span> exec bcftools_1.17.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="ex">singularity</span> exec bedops_v2.4.35dfsg-1-deb_cv1.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="ex">singularity</span> exec bedtools_2.31.0.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="ex">singularity</span> exec blast_2.14.0.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="ex">singularity</span> exec busco_v5.4.7_cv1.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="ex">singularity</span> exec bwa_0.7.17.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="ex">singularity</span> exec ncbi-datasets_latest.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="ex">singularity</span> exec samtools_1.17-2023-06.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="ex">singularity</span> exec vcftools_v0.1.16-1-deb_cv1.sif grep <span class="at">-E</span> <span class="st">'^(VERSION|NAME)='</span> /etc/os-release</span></code></pre>
</div>
<p>We see several different Ubuntu release and on Debian.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec bcftools_1.17.sif grep -E '^(VERSION|NAME)=' /etc/os-release
INFO:    underlay of /etc/localtime required more than 50 (75) bind mounts
NAME="Ubuntu"
VERSION="20.04.5 LTS (Focal Fossa)"
[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec bedops_v2.4.35dfsg-1-deb_cv1.sif grep -E '^(VERSION|NAME)=' /etc/os-release
NAME="Debian GNU/Linux"
VERSION="10 (buster)"
[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec bedtools_2.31.0.sif grep -E '^(VERSION|NAME)=' /etc/os-release
INFO:    underlay of /etc/localtime required more than 50 (69) bind mounts
NAME="Ubuntu"
VERSION="22.04.2 LTS (Jammy Jellyfish)"
[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec blast_2.14.0.sif grep -E '^(VERSION|NAME)=' /etc/os-release
INFO:    underlay of /etc/localtime required more than 50 (71) bind mounts
NAME="Ubuntu"
VERSION="20.04.6 LTS (Focal Fossa)"
[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec busco_v5.4.7_cv1.sif grep -E '^(VERSION|NAME)=' /etc/os-release
NAME="Debian GNU/Linux"
VERSION="10 (buster)"
[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec bwa_0.7.17.sif grep -E '^(VERSION|NAME)=' /etc/os-release
NAME="Ubuntu"
VERSION="16.04.7 LTS (Xenial Xerus)"
[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec ncbi-datasets_latest.sif grep -E '^(VERSION|NAME)=' /etc/os-release
INFO:    underlay of /etc/localtime required more than 50 (73) bind mounts
NAME="Ubuntu"
VERSION="22.04.2 LTS (Jammy Jellyfish)"
[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec samtools_1.17-2023-06.sif grep -E '^(VERSION|NAME)=' /etc/os-release
INFO:    underlay of /etc/localtime required more than 50 (70) bind mounts
NAME="Ubuntu"
VERSION="22.04.2 LTS (Jammy Jellyfish)"
[student@edu-vm-bdafb86b-1 04-pull]$ singularity exec vcftools_v0.1.16-1-deb_cv1.sif grep -E '^(VERSION|NAME)=' /etc/os-release
NAME="Debian GNU/Linux"
VERSION="10 (buster)"
</code></pre>
</div>
<p>Now lets download another bacteria with the ncbi-datasets</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> ncbi-datasets_latest.sif  datasets download genome accession GCF_001719145.1 <span class="at">--include</span> gff3,rna,cds,protein,genome,seq-report <span class="at">--filename</span> GCF_001719145.1.zip</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">unzip</span> GCF_001719145.1.zip</span></code></pre>
</div>
<p>We just download a gff, protein fasta, transcript fasta, genome fasta
and more for this accession.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lah</span>  ncbi_dataset/data/<span class="pp">*</span></span></code></pre>
</div>
<p>Lets run some of the bioinformatic tools.</p>
<p>Index the genome, transcriptome, and proteome cause why not.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> samtools_1.17-2023-06.sif samtools faidx  ncbi_dataset/data/GCF_001719145.1/GCF_001719145.1_ASM171914v1_genomic.fna</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> samtools_1.17-2023-06.sif samtools faidx  ncbi_dataset/data/GCF_001719145.1/cds_from_genomic.fna</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> samtools_1.17-2023-06.sif samtools faidx ncbi_dataset/data/GCF_001719145.1/protein.faa</span></code></pre>
</div>
<p>We can now see the <em>.fai</em> files have been added.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lah</span>  ncbi_dataset/data/GCF_001719145.1</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">head</span> ncbi_dataset/data/GCF_001719145.1/protein.faa.fai</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WP_002802878.1  86      100     80      81
WP_002804494.1  76      255     76      77
WP_002804983.1  90      418     80      81
WP_002805908.1  46      580     46      47
WP_002806026.1  208     728     80      81
WP_002806565.1  121     1002    80      81
WP_002808218.1  128     1212    80      81
WP_002808376.1  71      1409    71      72
WP_002808458.1  227     1565    80      81
WP_002808480.1  112     1870    80      81</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">sort</span> <span class="at">-nk</span> 2 ncbi_dataset/data/GCF_001719145.1/protein.faa.fai <span class="kw">|</span> <span class="fu">tail</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WP_069288208.1  1504    1554134 80      81
WP_005917363.1  1669    1264083 80      81
WP_033837051.1  1746    1522853 80      81
WP_033481971.1  1871    1504684 80      81
WP_269466082.1  2264    1673627 80      81
WP_033837667.1  2375    1534966 80      81
WP_033837612.1  2416    1528386 80      81
WP_033837670.1  2756    1537448 80      81
WP_005916482.1  2982    1177517 80      81
WP_005916057.1  3397    1136201 80      81</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> samtools_1.17-2023-06.sif samtools faidx  ncbi_dataset/data/GCF_001719145.1/protein.faa WP_005916057.1 </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> samtools_1.17-2023-06.sif samtools faidx  ncbi_dataset/data/GCF_001719145.1/protein.faa WP_005916057.1 <span class="op">&gt;</span> longest_prot.fasta</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> blast_2.14.0.sif makeblastdb <span class="at">-in</span> ncbi_dataset/data/GCF_001719145.1/GCF_001719145.1_ASM171914v1_genomic.fna <span class="at">-input_type</span> fasta <span class="at">-dbtype</span> nucl</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> blast_2.14.0.sif tblastn <span class="at">-query</span> longest_prot.fasta <span class="at">-db</span> ncbi_dataset/data/GCF_001719145.1/GCF_001719145.1_ASM171914v1_genomic.fna <span class="at">-outfmt</span> 7</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> blast_2.14.0.sif tblastn <span class="at">-query</span> longest_prot.fasta <span class="at">-db</span> ncbi_dataset/data/GCF_001719145.1/GCF_001719145.1_ASM171914v1_genomic.fna <span class="at">-outfmt</span> 6 <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f2,9,10</span> <span class="op">&gt;</span> hits.bed </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">cat</span> hits.bed </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">awk</span> <span class="st">'{ if ($2 &gt; $3) { t = $2; $2 = $3; $3 = t; } else if ($2 == $3) { $3 += 1; } print $0; }'</span> hits.bed  <span class="kw">|</span> <span class="ex">singularity</span> exec bedops_v2.4.35dfsg-1-deb_cv1.sif sort-bed <span class="at">-</span> <span class="op">&gt;</span> b.fixed.bed</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> bedtools_2.31.0.sif bedtools merge <span class="at">-i</span> b.fixed.bed</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="citations">citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h3>
<p>Awk command: <a href="https://www.biostars.org/p/304852/" class="external-link uri">https://www.biostars.org/p/304852/</a></p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div></section><section id="aio-05-singularity-build"><p>Content from <a href="05-singularity-build.html">05-singularity-build</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/05-singularity-build.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level3">
<h3 id="the-build-command">The build command<a class="anchor" aria-label="anchor" href="#the-build-command"></a>
</h3>
<p>Containers can be build from the same sources as pull command
library, docker, shub, oras as well as using a binary file as a
base.</p>
<p>Today we will focus on one of the most common builds, building on top
a container image from docker.</p>
<p>Builds that do not modify the source image generally can be built
with out sudo privileges, this is equivalent to a pull command.</p>
</div>
<div class="section level3">
<h3 id="take-away-parts-of-a-the-build-command-and-definition-file">Take away parts of a the build command and definition file<br><a class="anchor" aria-label="anchor" href="#take-away-parts-of-a-the-build-command-and-definition-file"></a>
</h3>
<ul>
<li>singularity build is used to build images from definition
file.<br>
</li>
<li>The definition file contains the directions to build the image,
similar to installing an OS.<br>
</li>
<li>
<strong>Bootstrap</strong> - the provider of the source images<br>
</li>
<li>
<strong>From</strong> - the source image/layers<br>
</li>
<li>
<strong>%post</strong> - commands issued to build the
container<br>
</li>
<li>
<strong>%environment</strong> - variables set at runtime<br>
</li>
<li>
<strong>%runscrip</strong> - commands executed when the container
image is run (either via the singularity run by executing the container
directly as a command</li>
</ul>
<p><strong>Example of build definition file:</strong></p>
<pre><code>Bootstrap: docker
From: ubuntu:16.04

%post
    apt-get -y update
    apt-get -y install fortune cowsay lolcat

%environment
    export LC_ALL=C
    export PATH=/usr/games:$PATH

%runscript
    fortune | cowsay | lolcat</code></pre>
<p><strong>Example of all the options for a definition
file.</strong></p>
<pre><code>Bootstrap: library
From: ubuntu:18.04

%setup
    touch /file1
    touch ${SINGULARITY_ROOTFS}/file2

%files
    /file1
    /file1 /opt

%environment
    export LISTEN_PORT=12345
    export LC_ALL=C

%post
    apt-get update &amp;&amp; apt-get install -y netcat
    NOW=`date`
    echo "export NOW=\"${NOW}\"" &gt;&gt; $SINGULARITY_ENVIRONMENT

%runscript
    echo "Container was created $NOW"
    echo "Arguments received: $*"
    exec echo "$@"

%startscript
    nc -lp $LISTEN_PORT

%test
    grep -q NAME=\"Ubuntu\" /etc/os-release
    if [ $? -eq 0 ]; then
        echo "Container base is Ubuntu as expected."
    else
        echo "Container base is not Ubuntu."
    fi

%labels
    Author d@sylabs.io
    Version v0.0.1

%help
    This is a demo container used to illustrate a def file that uses all
    supported sections.</code></pre>
<p>We will build containers later in the course.</p>
</div>
<div class="section level3">
<h3 id="citations">citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h3>
<p>Lesson adapted from:</p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div></section><section id="aio-06-bioinformatics-qc"><p>Content from <a href="06-bioinformatics-qc.html">06-bioinformatics-qc</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/06-bioinformatics-qc.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level3">
<h3 id="lets-build-a-container-image-for-something-not-in-dockerhub">Lets build a container image for something not in dockerhub<a class="anchor" aria-label="anchor" href="#lets-build-a-container-image-for-something-not-in-dockerhub"></a>
</h3>
</div>
<div class="section level3">
<h3 id="first-lets-check-our-data-files">First lets check our data files<a class="anchor" aria-label="anchor" href="#first-lets-check-our-data-files"></a>
</h3>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> /projects/my-lab/06-bio-qc</span></code></pre>
</div>
<p>View contents of directory file:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 180
-rw-rw-r-- 1 student student 82010 Jul 14 05:34 SRR10233452_subset_1.fastq.gz
-rw-rw-r-- 1 student student    64 Jul 14 05:34 SRR10233452_subset_1.fastq.gz.md5
-rw-rw-r-- 1 student student    61 Jul 14 05:34 SRR10233452_subset_1.fastq.md5
-rw-rw-r-- 1 student student 80450 Jul 14 05:34 SRR10233452_subset_2.fastq.gz
-rw-rw-r-- 1 student student    64 Jul 14 05:34 SRR10233452_subset_2.fastq.gz.md5
-rw-rw-r-- 1 student student    61 Jul 14 05:34 SRR10233452_subset_2.fastq.md5</code></pre>
</div>
<p>Lets make sure our files are correct with md5sum</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">cat</span> SRR10233452_subset_1.fastq.gz.md5</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0e6b0d752ca7bd9019cc4f5994950cf4  SRR10233452_subset_1.fastq.gz</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">md5sum</span> SRR10233452_subset_1.fastq.gz</span></code></pre>
</div>
<p>The output is the same so we know the file is correct.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0e6b0d752ca7bd9019cc4f5994950cf4  SRR10233452_subset_1.fastq.gz</code></pre>
</div>
<p>For second read just use the check function of md5sum.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">md5sum</span> <span class="at">-c</span> SRR10233452_subset_2.fastq.gz.md5 </span></code></pre>
</div>
<p>Prints and OK since the file is correct, otherwise it would say
FAILED.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">SRR10233452_subset_2.fastq.gz</span><span class="op">:</span> <span class="va">OK</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="now-we-can-run-some-containers">Now we can run some containers<a class="anchor" aria-label="anchor" href="#now-we-can-run-some-containers"></a>
</h3>
<p>Lets run FastQC.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">singularity</span> pull fastqc.sif docker://staphb/fastqc:0.12.1</span></code></pre>
</div>
<p><strong>the command above prints a lot of test to the
screen.</strong></p>
</div>
<div class="section level3">
<h3 id="use-ls-to-view-the-new-sif-file">Use <em>ls</em> to view the new sif file<a class="anchor" aria-label="anchor" href="#use-ls-to-view-the-new-sif-file"></a>
</h3>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">ls</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>fastqc.sif  SRR10233452_subset_1.fastq.gz  SRR10233452_subset_1.fastq.gz.md5  SRR10233452_subset_1.fastq.md5  SRR10233452_subset_2.fastq.gz  SRR10233452_subset_2.fastq.gz.md5  SRR10233452_subset_2.fastq.md5
</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="now-run-fastqc">Now run fastqc<a class="anchor" aria-label="anchor" href="#now-run-fastqc"></a>
</h3>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">singularity</span> exec fastqc.sif fastqc SRR10233452_subset_1.fastq.gz SRR10233452_subset_2.fastq.gz</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO:    underlay of /etc/localtime required more than 50 (81) bind mounts
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
        LANGUAGE = (unset),
        LC_ALL = (unset),
        LANG = "en_US.UTF-8"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
Skipping 'SRR10233452_subset_1.fastq.gz' which didn't exist, or couldn't be read
Skipping 'SRR10233452_subset_2.fastq.gz' which didn't exist, or couldn't be read</code></pre>
</div>
<p>Oh no we dont see the files, again.<br>
We can fix that.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> fastqc.sif fastqc SRR10233452_subset_1.fastq.gz SRR10233452_subset_2.fastq.gz</span></code></pre>
</div>
<p>Worked great.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LANGUAGE = (unset),
	LC_ALL = (unset),
	LANG = "en_US.UTF-8"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
Started analysis of SRR10233452_subset_1.fastq.gz
Approx 100% complete for SRR10233452_subset_1.fastq.gz
Analysis complete for SRR10233452_subset_1.fastq.gz
Started analysis of SRR10233452_subset_2.fastq.gz
Approx 100% complete for SRR10233452_subset_2.fastq.gz
Analysis complete for SRR10233452_subset_2.fastq.gz</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="use-ls-with-the-1-flag-to-see-the-files-in-the-directory">Use ls with the 1 flag to see the files in the directory<a class="anchor" aria-label="anchor" href="#use-ls-with-the-1-flag-to-see-the-files-in-the-directory"></a>
</h3>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">fastqc.sif</span></span>
<span><span class="va">SRR10233452_subset_1_fastqc.html</span></span>
<span><span class="va">SRR10233452_subset_1_fastqc.zip</span></span>
<span><span class="va">SRR10233452_subset_1.fastq.gz</span></span>
<span><span class="va">SRR10233452_subset_1.fastq.gz.md5</span></span>
<span><span class="va">SRR10233452_subset_1.fastq.md5</span></span>
<span><span class="va">SRR10233452_subset_2_fastqc.html</span></span>
<span><span class="va">SRR10233452_subset_2_fastqc.zip</span></span>
<span><span class="va">SRR10233452_subset_2.fastq.gz</span></span>
<span><span class="va">SRR10233452_subset_2.fastq.gz.md5</span></span>
<span><span class="va">SRR10233452_subset_2.fastq.md5</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="use-unzip-to-unzip-the-results-for-subset-1-">Use <em>unzip</em> to unzip the results for subset 1.<a class="anchor" aria-label="anchor" href="#use-unzip-to-unzip-the-results-for-subset-1-"></a>
</h3>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">unzip</span> SRR10233452_subset_1_fastqc.zip</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">Archive</span><span class="op">:</span>  <span class="va">SRR10233452_subset_1_fastqc.zip</span></span>
<span>   <span class="va">creating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span></span>
<span>   <span class="va">creating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Icons</span><span class="op">/</span></span>
<span>   <span class="va">creating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span></span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Icons</span><span class="op">/</span><span class="va">fastqc_icon.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Icons</span><span class="op">/</span><span class="va">warning.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Icons</span><span class="op">/</span><span class="va">error.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Icons</span><span class="op">/</span><span class="va">tick.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">summary.txt</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span><span class="va">per_base_quality.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span><span class="va">per_sequence_quality.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span><span class="va">per_base_sequence_content.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span><span class="va">per_sequence_gc_content.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span><span class="va">per_base_n_content.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span><span class="va">sequence_length_distribution.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span><span class="va">duplication_levels.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">Images</span><span class="op">/</span><span class="va">adapter_content.png</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">fastqc_report.html</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">fastqc_data.txt</span>  </span>
<span>  <span class="va">inflating</span><span class="op">:</span> <span class="va">SRR10233452_subset_1_fastqc</span><span class="op">/</span><span class="va">fastqc.fo</span>  </span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="use-cat-to-view-the-summary-results">Use <em>cat</em> to view the summary results<a class="anchor" aria-label="anchor" href="#use-cat-to-view-the-summary-results"></a>
</h3>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">cat</span> SRR10233452_subset_1_fastqc/summary.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>PASS	Basic Statistics	SRR10233452_subset_1.fastq.gz
PASS	Per base sequence quality	SRR10233452_subset_1.fastq.gz
PASS	Per sequence quality scores	SRR10233452_subset_1.fastq.gz
FAIL	Per base sequence content	SRR10233452_subset_1.fastq.gz
WARN	Per sequence GC content	SRR10233452_subset_1.fastq.gz
FAIL	Per base N content	SRR10233452_subset_1.fastq.gz
WARN	Sequence Length Distribution	SRR10233452_subset_1.fastq.gz
PASS	Sequence Duplication Levels	SRR10233452_subset_1.fastq.gz
PASS	Overrepresented sequences	SRR10233452_subset_1.fastq.gz
PASS	Adapter Content	SRR10233452_subset_1.fastq.gz
</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="prep-for-bwa">Prep for BWA<a class="anchor" aria-label="anchor" href="#prep-for-bwa"></a>
</h3>
<p>Now we can uncompress the ‘gzipped’ files with gunzip. Use the ‘-c
option to preserve the original file’</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">gunzip</span> SRR10233452_subset_1.fastq.gz SRR10233452_subset_2.fastq.gz</span></code></pre>
</div>
<p>Nothing is printed out.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<p>Can see changes with ‘ls’.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rwxrwxr-x 1 student student 297582592 Jul 14 12:21 fastqc.sif*
-rw-rw-r-- 1 student student    366018 Jul 14 12:06 SRR10233452_subset_1.fastq
-rw-rw-r-- 1 student student    218957 Jul 14 12:22 SRR10233452_subset_1_fastqc.html
-rw-rw-r-- 1 student student    225066 Jul 14 12:22 SRR10233452_subset_1_fastqc.zip
-rw-rw-r-- 1 student student        64 Jul 14 12:06 SRR10233452_subset_1.fastq.gz.md5
-rw-rw-r-- 1 student student        61 Jul 14 12:06 SRR10233452_subset_1.fastq.md5
-rw-rw-r-- 1 student student    355874 Jul 14 12:06 SRR10233452_subset_2.fastq
-rw-rw-r-- 1 student student    230235 Jul 14 12:22 SRR10233452_subset_2_fastqc.html
-rw-rw-r-- 1 student student    245117 Jul 14 12:22 SRR10233452_subset_2_fastqc.zip
-rw-rw-r-- 1 student student        64 Jul 14 12:06 SRR10233452_subset_2.fastq.gz.md5
-rw-rw-r-- 1 student student        61 Jul 14 12:06 SRR10233452_subset_2.fastq.md5</code></pre>
</div>
<div class="section level4">
<h4 id="try-downloading-the-zip-files-with-scp">Try downloading the zip files with <strong>scp</strong>
<a class="anchor" aria-label="anchor" href="#try-downloading-the-zip-files-with-scp"></a>
</h4>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</div></section><section id="aio-07-bioinformatics-bwa"><p>Content from <a href="07-bioinformatics-bwa.html">07-bioinformatics bwa</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/07-bioinformatics-bwa.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level3">
<h3 id="lets-use-bwa">Lets use bwa<a class="anchor" aria-label="anchor" href="#lets-use-bwa"></a>
</h3>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> /projects/my-lab/07-bwa</span></code></pre>
</div>
<p>View contents of directory file:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 15804
-rw-rw-r-- 1 student student 16171456 Jul 14 05:34 chr20.fna.gz
-rw-rw-r-- 1 student student       47 Jul 14 05:34 chr20.fna.gz.md5
-rw-rw-r-- 1 student student       44 Jul 14 05:34 chr20.fna.md5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">gunzip</span> chr20.fna.gz</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="now-make-an-index">Now make an index<a class="anchor" aria-label="anchor" href="#now-make-an-index"></a>
</h3>
<p>Pull a bwa image from dockerhub</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">singularity</span> pull bwa.sif docker://staphb/bwa:0.7.17</span></code></pre>
</div>
<p>Make and index</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> bwa.sif bwa index chr20.fna chr20.fna</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[bwa_index] Pack FASTA... 0.20 sec
[bwa_index] Construct BWT for the packed sequence...
[BWTIncCreate] textLength=108871774, availableWord=19660180
[BWTIncConstructFromPacked] 10 iterations done. 32429790 characters processed.
[BWTIncConstructFromPacked] 20 iterations done. 59910030 characters processed.
[BWTIncConstructFromPacked] 30 iterations done. 84330494 characters processed.
[BWTIncConstructFromPacked] 40 iterations done. 106031422 characters processed.
[bwt_gen] Finished constructing BWT in 42 iterations.
[bwa_index] 13.58 seconds elapse.
[bwa_index] Update BWT... 0.15 sec
[bwa_index] Pack forward-only FASTA... 0.13 sec
[bwa_index] Construct SA from BWT and Occ... 9.12 sec
[main] Version: 0.7.17-r1188
[main] CMD: /bwa/bwa-0.7.17/bwa index chr20.fna chr20.fna
[main] Real time: 23.272 sec; CPU: 23.231 sec</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>total 249052
-rwxrwxr-x 1 student student 104620032 Jul 14 06:48 bwa.sif*
-rw-rw-r-- 1 student student  55116442 Jul 14 05:34 chr20.fna
-rw-rw-r-- 1 student student       160 Jul 14 06:49 chr20.fna.amb
-rw-rw-r-- 1 student student       135 Jul 14 06:49 chr20.fna.ann
-rw-rw-r-- 1 student student  54435968 Jul 14 06:49 chr20.fna.bwt
-rw-rw-r-- 1 student student        47 Jul 14 05:34 chr20.fna.gz.md5
-rw-rw-r-- 1 student student        44 Jul 14 05:34 chr20.fna.md5
-rw-rw-r-- 1 student student  13608973 Jul 14 06:49 chr20.fna.pac
-rw-rw-r-- 1 student student  27217992 Jul 14 06:49 chr20.fna.sa</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> bwa.sif bwa mem chr20.fna /projects/my-lab/06-bio-qc/SRR10233452_subset_1.fastq /projects/my-lab/06-bio-qc/SRR10233452_subset_2.fastq <span class="op">&gt;</span> out_bwa.sam </span></code></pre>
</div>
<p>We get an error as the container can not see the fastq files in the
other directory</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0233452_subset_2.fastq &gt; out_bwa.sam
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[E::main_mem] fail to open file `/projects/my-lab/06-bio-qc/SRR10233452_subset_1.fastq'.</code></pre>
</div>
<p>Lets add a bind mount to the command so we can see them.<br>
Note: The mount location in the container does not need to exist in the
container.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> /projects/my-lab/06-bio-qc:/projects/my-lab/06-bio-qc <span class="at">-B</span> <span class="va">$PWD</span> bwa.sif bwa mem chr20.fna /projects/my-lab/06-bio-qc/SRR10233452_subset_1.fastq /projects/my-lab/06-bio-qc/SRR10233452_subset_2.fastq <span class="op">&gt;</span> out_bwa.sam </span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">head</span> <span class="at">-n</span> 7 out_bwa.sam</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="citations">Citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h3>
<p>singularity bind mounts <a href="https://docs.sylabs.io/guides/3.0/user-guide/bind_paths_and_mounts.html" class="external-link uri">https://docs.sylabs.io/guides/3.0/user-guide/bind_paths_and_mounts.html</a></p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div></section><section id="aio-08-circos"><p>Content from <a href="08-circos.html">08-circos</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/08-circos.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level3">
<h3 id="example-for-circos">Example for circos<a class="anchor" aria-label="anchor" href="#example-for-circos"></a>
</h3>
<p>Change directory into the circos directory.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> /projects/my-lab/08-circos</span></code></pre>
</div>
<p>Verify nothing is in the directory</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lF</span></span></code></pre>
</div>
<p>Make a circos SIF file by pulling the docker image circos.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">singularity</span> pull docker://alexcoppe/circos</span></code></pre>
</div>
<p>Download the circos tutorial.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">wget</span> http://circos.ca/distribution/circos-tutorials-current.tgz</span></code></pre>
</div>
<p>Untar and gzip the downloaded file.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">tar</span> xzvf circos-tutorials-current.tgz</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-1F</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">circos_latest.sif</span><span class="op">*</span></span>
<span><span class="va">circos</span><span class="op">-</span><span class="va">tutorials</span><span class="op">-</span><span class="fl">0.67</span><span class="op">/</span></span>
<span><span class="va">circos</span><span class="op">-</span><span class="va">tutorials</span><span class="op">-</span><span class="va">current.tgz</span></span></code></pre>
</div>
<p>Run tutorial 1/1</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> circos_latest.sif /opt/circos/bin/circos <span class="at">-conf</span> circos-tutorials-0.67/tutorials/1/1/circos.conf</span></code></pre>
</div>
<p>The base image of the human chromosomes was created</p>
<figure><img src="fig/circos_1_1.svg" alt="circos example 1 dot 1" class="figure mx-auto d-block"><div class="figcaption">circos_1_1</div>
</figure><p>Run tutorial 8/6 histograms</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> circos_latest.sif /opt/circos/bin/circos <span class="at">-conf</span> circos-tutorials-0.67/tutorials/8/6/circos.conf</span></code></pre>
</div>
<p>An image with histograms</p>
<figure><img src="fig/circos_8_6.svg" alt="circos example 8 dot 6" class="figure mx-auto d-block"><div class="figcaption">circos_8_6</div>
</figure><p>Run tutorial 8/11 links</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">-B</span> <span class="va">$PWD</span> circos_latest.sif /opt/circos/bin/circos <span class="at">-conf</span> circos-tutorials-0.67/tutorials/8/11/circos.conf</span></code></pre>
</div>
<p>An image with links</p>
<figure><img src="fig/circos_8_11.svg" alt="circos example 8 dot 11" class="figure mx-auto d-block"><div class="figcaption">circos_8_11</div>
</figure>
</div>
<div class="section level3">
<h3 id="citations">citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h3>
<p><a href="http://circos.ca/" class="external-link uri">http://circos.ca/</a></p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div></section><section id="aio-09-singularity-build-blast-example"><p>Content from <a href="09-singularity-build-blast-example.html">09-singularity-build</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/09-singularity-build-blast-example.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level1">
<h1 id="using-containers-questions">Using Containers &amp; Questions<a class="anchor" aria-label="anchor" href="#using-containers-questions"></a>
</h1>
<p>Building on our previous sections, in this unit, we’re going to build
a container for BLAST and show how to use that container to construct a
BLAST database and search sequences against that database.</p>
<div class="section level2">
<h2 id="containerizing-blast">Containerizing BLAST<a class="anchor" aria-label="anchor" href="#containerizing-blast"></a>
</h2>
<p>BLAST stands for Basic Local Alignment Search Tool, and is a
sophisticated software package for rapid searching of protein and
nucleotide databases. BLAST was developed by Steven Altschul in 1989,
and has continually been refined, updated, and modified throughout the
years to meet the increasing needs of the scientific community.</p>
<p>To cite BLAST, please refer to the following: Altschul SF, Gish W,
Miller W, Myers EW, Lipman DJ. Basic local alignment search tool.
Journal of Molecular Biology. Volume 215(3), pages 403-410. 1990. PMID:
2231712 DOI: 10.1016/S0022-2836(05)80360-2.</p>
<p>To start, let’s create an empty file to use as our recipe file.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> /projects/my-lab/09-build-blast</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">touch</span> blast.def</span></code></pre>
</div>
<p>The touch command allows modification of file timestamps, or in the
case of this usage, where the file does not already exist, creates an
empty file.</p>
<p>Now we’ll use nano to build out our recipe file.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">nano</span> blast.def</span></code></pre>
</div>
<p>This should open the basic nano text editor for you to access through
your terminal.</p>
<p>Let’s type the following into our blast.def file:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">Bootstrap:docker</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">From:ubuntu</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="ex">%labels</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        <span class="ex">MAINTAINER</span> Kurt Showmaker</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="ex">%post</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>        <span class="ex">apt</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> upgrade <span class="at">-y</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>        <span class="ex">apt</span> install <span class="at">-y</span> wget gzip zip unzip ncbi-blast+ locales</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>        <span class="va">LANG</span><span class="op">=</span>C <span class="fu">perl</span> <span class="at">-e</span> exit</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>        <span class="ex">locale-gen</span> en_US.UTF-8</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="ex">%runscript</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"Hello from BLAST!"</span></span></code></pre>
</div>
<p>Let’s hit <code>CTRL-O</code> to save our modifications and then
<code>CTRL-X</code> to exit the nano editor.</p>
<p>Ok, now to build the container:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">sudo</span> singularity build blast.sif blast.def</span></code></pre>
</div>
<p>Ok, let’s test that our container is built properly.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">./blast.sif</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Hello from BLAST!</code></pre>
</div>
<p>Ok, now we can go into the container’s environment to verify things
using the singularity shell command.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">singularity</span> shell blast.sif</span></code></pre>
</div>
<p>Notice the change in prompt from “$” to ”Apptainer&gt;”, this is
because we are inside the container.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">Apptainer</span><span class="op">&gt;</span> blastp <span class="at">-h</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>USAGE
  blastp [-h] [-help] [-import_search_strategy filename]
    [-export_search_strategy filename] [-task task_name] [-db database_name]
    [-dbsize num_letters] [-gilist filename] [-seqidlist filename]
    [-negative_gilist filename] [-negative_seqidlist filename]
    [-taxids taxids] [-negative_taxids taxids] [-taxidlist filename]
    [-negative_taxidlist filename] [-ipglist filename]
    [-negative_ipglist filename] [-entrez_query entrez_query]
    [-db_soft_mask filtering_algorithm] [-db_hard_mask filtering_algorithm]
    [-subject subject_input_file] [-subject_loc range] [-query input_file]
    [-out output_file] [-evalue evalue] [-word_size int_value]
    [-gapopen open_penalty] [-gapextend extend_penalty]
    [-qcov_hsp_perc float_value] [-max_hsps int_value]
    [-xdrop_ungap float_value] [-xdrop_gap float_value]
    [-xdrop_gap_final float_value] [-searchsp int_value] [-seg SEG_options]
    [-soft_masking soft_masking] [-matrix matrix_name]
    [-threshold float_value] [-culling_limit int_value]
    [-best_hit_overhang float_value] [-best_hit_score_edge float_value]
    [-subject_besthit] [-window_size int_value] [-lcase_masking]
    [-query_loc range] [-parse_deflines] [-outfmt format] [-show_gis]
    [-num_descriptions int_value] [-num_alignments int_value]
    [-line_length line_length] [-html] [-sorthits sort_hits]
    [-sorthsps sort_hsps] [-max_target_seqs num_sequences]
    [-num_threads int_value] [-ungapped] [-remote] [-comp_based_stats compo]
    [-use_sw_tback] [-version]

DESCRIPTION
   Protein-Protein BLAST 2.9.0+

Use '-help' to print detailed descriptions of command line arguments</code></pre>
</div>
<p>The blastp command is for Protein BLASTs, where a protein sequence is
searched against a protein database.</p>
<p>Let’s exit the container environment.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">Apptainer</span><span class="op">&gt;</span> exit</span></code></pre>
</div>
<p>Now let’s try the containerized command from the server’s
environment.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">singularity</span> exec blast.sif blastp <span class="at">-h</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>USAGE
  blastp [-h] [-help] [-import_search_strategy filename]
    [-export_search_strategy filename] [-task task_name] [-db database_name]
    [-dbsize num_letters] [-gilist filename] [-seqidlist filename]
    [-negative_gilist filename] [-negative_seqidlist filename]
    [-taxids taxids] [-negative_taxids taxids] [-taxidlist filename]
    [-negative_taxidlist filename] [-ipglist filename]
    [-negative_ipglist filename] [-entrez_query entrez_query]
    [-db_soft_mask filtering_algorithm] [-db_hard_mask filtering_algorithm]
    [-subject subject_input_file] [-subject_loc range] [-query input_file]
    [-out output_file] [-evalue evalue] [-word_size int_value]
    [-gapopen open_penalty] [-gapextend extend_penalty]
    [-qcov_hsp_perc float_value] [-max_hsps int_value]
    [-xdrop_ungap float_value] [-xdrop_gap float_value]
    [-xdrop_gap_final float_value] [-searchsp int_value] [-seg SEG_options]
    [-soft_masking soft_masking] [-matrix matrix_name]
    [-threshold float_value] [-culling_limit int_value]
    [-best_hit_overhang float_value] [-best_hit_score_edge float_value]
    [-subject_besthit] [-window_size int_value] [-lcase_masking]
    [-query_loc range] [-parse_deflines] [-outfmt format] [-show_gis]
    [-num_descriptions int_value] [-num_alignments int_value]
    [-line_length line_length] [-html] [-sorthits sort_hits]
    [-sorthsps sort_hsps] [-max_target_seqs num_sequences]
    [-num_threads int_value] [-ungapped] [-remote] [-comp_based_stats compo]
    [-use_sw_tback] [-version]

DESCRIPTION
   Protein-Protein BLAST 2.9.0+

Use '-help' to print detailed descriptions of command line arguments</code></pre>
</div>
<p>Same output, so now let’s put our new BLAST container to use!</p>
</div>
<div class="section level2">
<h2 id="acquiring-protein-data">Acquiring Protein Data<a class="anchor" aria-label="anchor" href="#acquiring-protein-data"></a>
</h2>
<p>To start, we are going to need some data to serve as our database to
search against. For this exercise, we will use C. elegans proteome.
Let’s download and uncompress this file.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">wget</span> https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/002/985/GCF_000002985.6_WBcel235/GCF_000002985.6_WBcel235_protein.faa.gz</span></code></pre>
</div>
<p>This shouldn’t take long, and produces the following output:</p>
<pre><code>Resolving ftp.ncbi.nlm.nih.gov (ftp.ncbi.nlm.nih.gov)... 165.112.9.229, 130.14.250.13, 2607:f220:41f:250::228, ...
Connecting to ftp.ncbi.nlm.nih.gov (ftp.ncbi.nlm.nih.gov)|165.112.9.229|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 6989933 (6.7M) [application/x-gzip]
Saving to: ‘GCF_000002985.6_WBcel235_protein.faa.gz’

100%[=======================================================================&gt;] 6,989,933   41.1MB/s   in 0.2s

2021-12-02 19:13:56 (41.1 MB/s) - ‘GCF_000002985.6_WBcel235_protein.faa.gz’ saved [6989933/6989933]
</code></pre>
<p>Now we will unzip the data file.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">gunzip</span> GCF_000002985.6_WBcel235_protein.faa.gz</span></code></pre>
</div>
<p>Now we will convert the protein FASTA file we downloaded into a BLAST
database to search against.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="bu">time</span> singularity exec <span class="at">-B</span> <span class="va">$PWD</span> blast.sif makeblastdb <span class="at">-in</span> GCF_000002985.6_WBcel235_protein.faa <span class="at">-dbtype</span> prot <span class="at">-out</span> c_elegans</span></code></pre>
</div>
<p>This gives us the following output:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Building a new DB, current time: 12/02/2021 19:14:39
New DB name:   /home/student/c_elegans
New DB title:  GCF_000002985.6_WBcel235_protein.faa
Sequence type: Protein
Keep MBits: T
Maximum file size: 1000000000B
Adding sequences from FASTA; added 28350 sequences in 0.727009 seconds.

real    0m1.248s
user    0m0.828s
sys     0m0.421s</code></pre>
</div>
<p>Now we need some sequences of interest to search against the RefSeq
database we just constructed. Let’s download all the RefSeq proteins for
Human Chromosome 1:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">wget</span> ftp://ftp.ncbi.nih.gov/refseq/H_sapiens/mRNA_Prot/human.1.protein.faa.gz</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>--2021-12-02 19:15:08--  ftp://ftp.ncbi.nih.gov/refseq/H_sapiens/mRNA_Prot/human.1.protein.faa.gz
           =&gt; ‘human.1.protein.faa.gz’
Resolving ftp.ncbi.nih.gov (ftp.ncbi.nih.gov)... 130.14.250.10, 130.14.250.11, 2607:f220:41f:250::230, ...
Connecting to ftp.ncbi.nih.gov (ftp.ncbi.nih.gov)|130.14.250.10|:21... connected.
Logging in as anonymous ... Logged in!
==&gt; SYST ... done.    ==&gt; PWD ... done.
==&gt; TYPE I ... done.  ==&gt; CWD (1) /refseq/H_sapiens/mRNA_Prot ... done.
==&gt; SIZE human.1.protein.faa.gz ... 1836521
==&gt; PASV ... done.    ==&gt; RETR human.1.protein.faa.gz ... done.
Length: 1836521 (1.8M) (unauthoritative)

100%[=======================================================================&gt;] 1,836,521   8.92MB/s   in 0.2s

2021-12-02 19:15:08 (8.92 MB/s) - ‘human.1.protein.faa.gz’ saved [1836521]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">gunzip</span> human.1.protein.faa.gz</span></code></pre>
</div>
<p>We’ve downloaded a multi-line FASTA file, but for ease of use, we
will now convert this into a single-fasta.</p>
<p>Convert multi-line FASTA to single-line FASTA</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-e</span> <span class="st">'s/\(^&gt;.*$\)/#\1#/'</span> human.1.protein.faa <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">"\r"</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">"\n"</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="at">-e</span> <span class="st">'s/$/#/'</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">"#"</span> <span class="st">"\n"</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="at">-e</span> <span class="st">'/^$/d'</span> <span class="op">&gt;</span> human.1.protein.faa.cleaned.fasta</span></code></pre>
</div>
<p>Now, we’ll BLAST the proteins of Human chromosome 1 against the
c_elegans blast database. Normally, you would want to run your entire
query sequence against the database and interpret results, but because
these cloud systems we are connected to are small, in the interest of
time we are going to reduce our number of query sequences.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">head</span> <span class="at">-n</span> 20 human.1.protein.faa.cleaned.fasta <span class="op">&gt;</span> search_query.fasta</span></code></pre>
</div>
<p>This pulls the first 10 protein sequences listed in the human
chromosome 1 file into a new file, search_query.fasta. So instead of
searching all 8,067 sequences, we will only search 10 (0.1%) against the
c_elegans database we’ve constructed.</p>
<p>Here We will run blast program using our input and constructed blast
database.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="bu">time</span> singularity exec <span class="at">-B</span> <span class="va">$PWD</span> blast.sif blastp <span class="at">-num_threads</span> 2 <span class="at">-db</span> c_elegans <span class="at">-query</span> search_query.fasta <span class="at">-outfmt</span> 6 <span class="at">-out</span> BLASTP_Results.txt <span class="at">-max_target_seqs</span> 1</span></code></pre>
</div>
<p>This gives us the following output:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Warning: [blastp] Examining 5 or more matches is recommended

real    0m5.957s
user    0m10.364s
sys     0m0.500s</code></pre>
</div>
<p>Checking the output file:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">head</span> BLASTP_Results.txt</span></code></pre>
</div>
<p>Gives the following:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>NP_001355814.1  NP_001255859.1  41.697  542     273     10      122     646     77      592     1.46e-58        208
NP_001355814.1  NP_001255859.1  41.199  517     259     9       125     626     154     640     2.69e-57        205
NP_001355814.1  NP_001255859.1  38.609  575     266     9       116     646     109     640     3.11e-54        196
NP_001355814.1  NP_001255859.1  39.962  533     256     10      112     618     156     650     8.53e-53        192
NP_001355814.1  NP_001255859.1  40.393  458     211     9       109     565     243     639     1.33e-49        183
NP_001355814.1  NP_001255859.1  38.647  207     105     5       108     314     455     639     2.77e-15        79.3
NP_001355815.1  NP_001255859.1  40.937  491     220     10      1       472     153     592     4.73e-56        197
NP_001355815.1  NP_001255859.1  39.038  520     232     13      2       472     80      563     1.16e-48        177
NP_001355815.1  NP_001255859.1  42.958  426     196     9       76      459     75      495     9.38e-47        171
NP_001355815.1  NP_001255859.1  40.086  464     218     11      2       444     220     644     9.89e-44        163</code></pre>
</div>
</div>
</div>
<div class="section level1">
<h1 id="any-questions">Any Questions?<a class="anchor" aria-label="anchor" href="#any-questions"></a>
</h1>
<p>Please ask the presenters any questions you may have!</p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div></section><section id="aio-10-singularity_build_rstudio"><p>Content from <a href="10-singularity_build_rstudio.html">10-singularity-build-rstudio</a></p>
<hr>
<p>Last updated on 2024-03-11 |
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/episodes/10-singularity_build_rstudio.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="section level1">
<h1 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h1>
<p>This build of rstudio is for demonstration purposes only on these
demo instances. For production purposes please consult your local system
admin.</p>
<div class="section level2">
<h2 id="containerizing-rstudio">Containerizing Rstudio<a class="anchor" aria-label="anchor" href="#containerizing-rstudio"></a>
</h2>
<p>CITE ROCKER AND RICHARD</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> /projects/my-lab/10-build-rstudio</span></code></pre>
</div>
<p>To start, create a few directories Rstudio server looks for.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="va">workdir</span><span class="op">=</span>/projects/my-lab/10-build-rstudio</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="at">-m</span> 700 <span class="va">${workdir}</span>/run <span class="va">${workdir}</span>/tmp <span class="va">${workdir}</span>/var/lib/rstudio-server</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&gt;</span> <span class="va">${workdir}</span>/database.conf <span class="op">&lt;&lt;END</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="st">provider=sqlite</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="st">directory=/var/lib/rstudio-server</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="op">END</span></span></code></pre>
</div>
<p>To start, let’s create an empty file to use as our recipe file. #lets
build an Rstudio server and install a few R/Bioconductor pacages into
the container.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">nano</span> rdeseq2.def</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">Bootstrap:</span> docker</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">From:</span> rocker/tidyverse:4.2.1</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#This def file doesn't seem to build on Sumner with Centos 7.  Richard suggests building on an Ubuntu system but we will stick with Centos 7.</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="ex">%post</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="ex">apt</span> update</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="ex">apt</span> install <span class="at">-y</span> libgeos-dev libglpk-dev <span class="co"># libcurl4-openssl-dev</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="ex">apt</span> install <span class="at">-y</span> libcurl4-gnutls-dev libxml2-dev cmake  libbz2-dev</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="ex">apt</span> install <span class="at">-y</span> libxslt1-dev  <span class="co"># install for sandpaper</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">'if (!require("BiocManager", quietly = TRUE))</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="st">    install.packages("BiocManager")</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="st">BiocManager::install("DESeq2")'</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">sudo</span> time singularity build rdeseq2.sif rdeseq2.def</span></code></pre>
</div>
<p>View files inside directory. Notice no R directory.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lah</span> </span></code></pre>
</div>
<p>Set the run time variables and deploy.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">SINGULARITY_BIND</span><span class="op">=</span><span class="st">"</span><span class="va">${workdir}</span><span class="st">/run:/run,</span><span class="va">${workdir}</span><span class="st">/tmp:/tmp,</span><span class="va">${workdir}</span><span class="st">/database.conf:/etc/rstudio/database.conf,</span><span class="va">${workdir}</span><span class="st">/var/lib/rstudio-server:/var/lib/rstudio-server"</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="bu">export</span> <span class="va">SINGULARITYENV_USER</span><span class="op">=</span><span class="va">$(</span><span class="fu">id</span> <span class="at">-un</span><span class="va">)</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="bu">export</span> <span class="va">SINGULARITYENV_PASSWORD</span><span class="op">=</span>password</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="ex">singularity</span> exec <span class="at">--cleanenv</span> rdeseq2.sif rserver <span class="at">--www-port</span> 8787 <span class="at">--auth-none</span><span class="op">=</span>0 <span class="at">--auth-pam-helper-path</span><span class="op">=</span>pam-helper <span class="at">--auth-stay-signed-in-days</span><span class="op">=</span>30 <span class="at">--auth-timeout-minutes</span><span class="op">=</span>0 <span class="at">--server-user</span>  <span class="st">"student"</span></span></code></pre>
</div>
<p><strong>navigate to <code>&lt;your_IP&gt;:8787</code></strong>
<strong>username is student</strong> <strong>password is set above to
password</strong></p>
<p>Lets load a package that from the container.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">'DESeq2'</span><span class="op">)</span></span></code></pre>
</div>
<p>Using the Rstudio file browser look at the R folder that appeared,
but nothing is in it.</p>
<p>Lets install something to the user space.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"EnhancedVolcano"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we see the local user install.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">.libPaths</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "/home/student/R/x86_64-pc-linux-gnu-library/4.2"
[2] "/usr/local/lib/R/site-library"                  
[3] "/usr/local/lib/R/library"    </code></pre>
</div>
<p><strong>Verify the libs with terminal tab</strong><br><code>ls /home/student/R/x86_64-pc-linux-gnu-library/4.2</code><br><code>ls /usr/local/lib/R</code></p>
<p><strong>Verify via ssh’ing with another tab</strong><br><code>ssh student@&lt;IP&gt;</code><br><code>ls /home/student/R/x86_64-pc-linux-gnu-library/4.2</code>
<code>ls /usr/local/lib/R</code></p>
<p>Lets install few fun packages.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'knitr'</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">options</span><span class="op">(</span>repos <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  carpentries <span class="op">=</span> <span class="st">"https://carpentries.r-universe.dev/"</span>, </span>
<span>  CRAN <span class="op">=</span> <span class="st">"https://cran.rstudio.com/"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"sandpaper"</span>, dep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>note the sandpaper command will reset the rstudio
server.</strong><br><strong>select dont save</strong></p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">'sandpaper'</span><span class="op">)</span></span>
<span><span class="fu">sandpaper</span><span class="fu">::</span><span class="fu">create_lesson</span><span class="op">(</span><span class="st">"~/r-intermediate-penguins"</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>after reset we are now in the new folder</strong></p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sandpaper</span><span class="fu">::</span><span class="fu">serve</span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">FALSE</span>, host <span class="op">=</span> <span class="st">"0.0.0.0"</span>, port <span class="op">=</span> <span class="st">"8789"</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Now edit one of the episodes</strong></p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">servr</span><span class="fu">::</span><span class="fu">daemon_stop</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="knit-example">Knit example<a class="anchor" aria-label="anchor" href="#knit-example"></a>
</h3>
<p>Make new folder called myknit.<br>
Make file in folder called myknit.Rmd<br>
Copy section of code (lines 56 to 101) from the link below and paste
into new myknit.Rmd file.</p>
<p>#<a href="https://github.com/sachsmc/knit-git-markr-guide/blob/master/knitr/knit.Rmd" class="external-link uri">https://github.com/sachsmc/knit-git-markr-guide/blob/master/knitr/knit.Rmd</a></p>
<p><strong>Caution: just an example below, use copy lines from link
above</strong></p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a> <span class="st">```</span><span class="at">{r setup, include=FALSE}</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="at">library(stringr)</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="at">library(knitr)</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="at">opts_chunk$set(tidy = FALSE)</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="at">knit_hooks$set(source = function(x, options){</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="at">  if (!is.null(options$verbatim) &amp;&amp; options$verbatim){</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="at">    opts = gsub(",</span><span class="sc">\\</span><span class="at">s*verbatim</span><span class="sc">\\</span><span class="at">s*=</span><span class="sc">\\</span><span class="at">s*TRUE</span><span class="sc">\\</span><span class="at">s*", "", options$params.src)</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="at">    bef = sprintf('</span><span class="sc">\n\n</span><span class="at">    </span><span class="st">```</span>{r %s}\n<span class="st">', opts, "</span><span class="sc">\n</span><span class="st">")</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="st">    stringr::str_c(</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="st">      bef, </span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="st">      knitr:::indent_block(paste(x, collapse = '</span>\n<span class="st">'), "    "), </span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="st">      "</span><span class="sc">\n</span><span class="st">    ```</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="st">  } else {</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="st">    stringr::str_c("</span><span class="sc">\n\n</span><span class="st">```", tolower(options$engine), "</span><span class="sc">\n</span><span class="st">", </span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="st">      paste(x, collapse = '</span>\n<span class="st">'), "</span><span class="sc">\n</span><span class="st">```</span><span class="sc">\n\n</span><span class="st">"</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="st">    )</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="st">})</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="citations-and-more-information">Citations and more information<a class="anchor" aria-label="anchor" href="#citations-and-more-information"></a>
</h3>
<p>Example:<br><a href="https://rpubs.com/Ilyashaikall/ClusteringofWine" class="external-link uri">https://rpubs.com/Ilyashaikall/ClusteringofWine</a></p>
<p><a href="https://rpubs.com/diyasarya/diabet" class="external-link uri">https://rpubs.com/diyasarya/diabet</a></p>
<p><a href="https://rpubs.com/" class="external-link uri">https://rpubs.com/</a></p>
<p><a href="https://bookdown.org/yihui/rmarkdown/rmarkdown-site.html" class="external-link uri">https://bookdown.org/yihui/rmarkdown/rmarkdown-site.html</a></p>
<p><a href="https://github.com/rstudio/rmarkdown-website-examples" class="external-link uri">https://github.com/rstudio/rmarkdown-website-examples</a></p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</div>
</div></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/" class="external-link">Source</a></p>
				<p><a href="https://github.com/TheJacksonLaboratory/singularity-workshop-2023/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:kurt.showmaker@jax.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.3" class="external-link">sandpaper (0.16.3)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.4" class="external-link">pegboard (0.7.4)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://TheJacksonLaboratory.github.io/singularity-workshop-2023/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://TheJacksonLaboratory.github.io/singularity-workshop-2023/aio.html",
  "identifier": "https://TheJacksonLaboratory.github.io/singularity-workshop-2023/aio.html",
  "dateCreated": "2024-03-11",
  "dateModified": "2024-03-19",
  "datePublished": "2024-03-19"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

